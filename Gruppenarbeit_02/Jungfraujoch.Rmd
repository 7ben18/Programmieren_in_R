---
title: "prr Gruppenarbeit 2"
subtitle: "Studiengang Data Science (HS2022), FHNW"
author: "Patrick Schürmann, Si Ben Tran, Gabriel Torres"
date: "Letzte Aktualisierungen: `r format(Sys.time(), '%B %d, %Y')`"
output:
  bookdown::html_document2:
      code_folding: show
      toc: true
      toc_depth: 3
      toc_float: true
      number_sections: true
editor_options: 
  chunk_output_type: console
---

# Einleitung
Wir beschäftigen uns mit den Daten des Bundesamt für Meteorologie. Wir haben dafür einen Export der Wetterstation Jungfraujoch (3571 m ü.M.) vom Jahr 2020.

# Hypothese / Fragestellungen
1) Wie sind die Korrelationen zwischen den verschiedenen Variablen?
// 2) Könnte man im Winter mit Solarpanels etwa gleich viel Strom wie im Sommer produzieren?
// 3) Was sind die idealen Wetterbedingungen für maximale Stromproduktion anhand Solarpanels?
4) Wie sieht der Jahreswetterverlauf auf 3500 m Höhe aus?
5) Kann man anhand des Luftdrucks eine rudimentäre Wettervorhersage erstellen?

# Libraries importieren
```{r}
library(plotly)
library(corrplot)
library(lubridate)
library(tidyverse)
```

# Data Wrangling
```{r}
data <- read.csv(file = "Meteodaten.csv", sep = ";")
data <- data %>%
  select(time,
    "Böenspitze" = fkl010z1, # in Meter/Sekunde
    "Windgeschwindigkeit" = fkl010za, # in Meter/Sekunde
    "Windrichtung" = dkl010za, # in Grad
    "Sonnenscheindauer" = sre000z0, # in Minuten
    "Gesamtbewölkung" = nto000s0, # in octas
    "Luftfeuchtigkeit" = ure200s0, # in Prozent
    "Lufttemperatur" = tre200s0, # in Grad Celsius
    "Luftdruck" = prestas0 # in Hectopascal
  ) # Erweiterbar :)

data$time <- ymd_hm(data$time)
data$Böenspitze <- as.numeric(data$Böenspitze)
data$Windgeschwindigkeit <- as.numeric(data$Windgeschwindigkeit)
data$Windrichtung <- as.numeric(data$Windrichtung)
data$Sonnenscheindauer <- as.numeric(data$Sonnenscheindauer)
# data$Gesamtbewölkung <- as.numeric(data$Gesamtbewölkung)
data$Luftfeuchtigkeit <- as.numeric(data$Luftfeuchtigkeit)
data$Lufttemperatur <- as.numeric(data$Lufttemperatur)
data$Luftdruck <- as.numeric(data$Luftdruck)
```

# Beantwortung der Fragestellungen
## Wie sind die Korrelationen zwischen den verschiedenen Variablen?
```{r}
corrData <- data %>%
  select(
    "Böenspitze",
    "Windgeschwindigkeit",
    "Windrichtung",
    "Sonnenscheindauer",
    "Luftfeuchtigkeit",
    "Lufttemperatur",
    "Luftdruck"
  ) %>%
  cor(., use = "pairwise.complete.obs")
corrplot(corrData, method = "ellipse", order = "alphabet", type = "upper", tl.pos = "lt")
```

Die stärksten Korrelationen sind Windgeschwindigkeit ~ Böenspitze, LangwelligeEinstrahlung ~ Luftfeuchtigkeit und Luftdruck ~ Lufttemperatur.  

## Frage 2
```{r}

```


## Frage 3
```{r}

```

## Wie sieht der Jahreswetterverlauf auf 3500 m Höhe aus?
```{r}
granularity <- "day"

plot <- data %>%
  group_by(time = floor_date(time, granularity)) %>%
  summarise(
    mean_Lufttemperatur = mean(Lufttemperatur),
    mean_Luftfeuchtigkeit = mean(Luftfeuchtigkeit),
    mean_Windgeschwindigkeit = mean(Windgeschwindigkeit),
    Sonnenscheindauer_h = sum(Sonnenscheindauer) / 60
    )

plot_ly(
  data = plot,
  type = "scatter",
  mode = "lines",
  width = 900,
  height = 700
) %>%
  add_trace(x = ~time, y = ~mean_Lufttemperatur, name = "Lufttemperatur °C") %>%
  add_trace(x = ~time, y = ~mean_Luftfeuchtigkeit, name = "Luftfeuchtigkeit in %", visible = "legendonly") %>%
  add_trace(x = ~time, y = ~Sonnenscheindauer_h, name = "Sonnenscheindauer in h", visible = "legendonly") %>%
  add_trace(x = ~time, y = ~mean_Windgeschwindigkeit, name = "Windgeschwindigkeit in m/s", visible = "legendonly") %>%
  layout(
    showlegend = TRUE,
    title = "Wetterverlauf im Jungfraujoch über das Jahr 2020",
    xaxis = list(
      title = "Zeitachse",
      rangeslider = list(visible = T),
      rangeselector = list(
        buttons = list(
          list(count = 1, label = "1m", step = "month"),
          list(count = 1, label = "all", step = "year")
        )
      ),
      zerolinecolor = "#ffff",
      zerolinewidth = 2,
      gridcolor = "ffff"
    ),
    yaxis = list(
      title = "",
      zerolinecolor = "#ffff",
      zerolinewidth = 2,
      gridcolor = "ffff"
    ),
    plot_bgcolor = "#e5ecf6",
    margin = 0.2
  )
```

## Kann man anhand des Luftdrucks eine rudimentäre Wettervorhersage erstellen?
```{r}

```
